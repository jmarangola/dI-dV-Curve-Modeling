syms x t E
assume(x, "real");
assume(t, "real");

j = (sqrt(-1)*(-1/2)).*t+(-1/2).*t.^2+(sqrt(-1)*(-1)).*t.*x.^(-1)+(sqrt(-1)* ...
  (1/12)).*(11.*t+(sqrt(-1)*3).*t.^2+2.*t.^3).*x+((sqrt(-1)*(1/2)).*t+( ...
  11/24).*t.^2+(sqrt(-1)*(1/12)).*t.^3+(1/24).*t.^4).*x.^2+((sqrt(-1)*( ...
  -659/720)).*t+(1/4).*t.^2+(sqrt(-1)*(-11/72)).*t.^3+(1/48).*t.^4+(sqrt( ...
  -1)*(-1/120)).*t.^5).*x.^3+((sqrt(-1)*(-1/2)).*t+(-659/1440).*t.^2+( ...
  sqrt(-1)*(-1/12)).*t.^3+(-11/288).*t.^4+(sqrt(-1)*(-1/240)).*t.^5+( ...
  -1/720).*t.^6).*x.^4+((sqrt(-1)*(27677/30240)).*t+(-1/4).*t.^2+(sqrt(-1) ...
  *(659/4320)).*t.^3+(-1/48).*t.^4+(sqrt(-1)*(11/1440)).*t.^5+(-1/1440).* ...
  t.^6+(sqrt(-1)*(1/5040)).*t.^7).*x.^5+((sqrt(-1)*(1/2)).*t+(27677/60480) ...
  .*t.^2+(sqrt(-1)*(1/12)).*t.^3+(659/17280).*t.^4+(sqrt(-1)*(1/240)).* ...
  t.^5+(11/8640).*t.^6+(sqrt(-1)*(1/10080)).*t.^7+(1/40320).*t.^8).*x.^6+( ...
  (sqrt(-1)*(-1107079/1209600)).*t+(1/4).*t.^2+(sqrt(-1)*(-27677/181440)) ...
  .*t.^3+(1/48).*t.^4+(sqrt(-1)*(-659/86400)).*t.^5+(1/1440).*t.^6+(sqrt( ...
  -1)*(-11/60480)).*t.^7+(1/80640).*t.^8+(sqrt(-1)*(-1/362880)).*t.^9).* ...
  x.^7+((sqrt(-1)*(-1/2)).*t+(-1107079/2419200).*t.^2+(sqrt(-1)*(-1/12)).* ...
  t.^3+(-27677/725760).*t.^4+(sqrt(-1)*(-1/240)).*t.^5+(-659/518400).* ...
  t.^6+(sqrt(-1)*(-1/10080)).*t.^7+(-11/483840).*t.^8+(sqrt(-1)*( ...
  -1/725760)).*t.^9+(-1/3628800).*t.^10).*x.^8+((sqrt(-1)*( ...
  219201637/239500800)).*t+(-1/4).*t.^2+(sqrt(-1)*(1107079/7257600)).* ...
  t.^3+(-1/48).*t.^4+(sqrt(-1)*(27677/3628800)).*t.^5+(-1/1440).*t.^6+( ...
  sqrt(-1)*(659/3628800)).*t.^7+(-1/80640).*t.^8+(sqrt(-1)*(11/4354560)).* ...
  t.^9+(-1/7257600).*t.^10+(sqrt(-1)*(1/39916800)).*t.^11).*x.^9+((sqrt( ...
  -1)*(1/2)).*t+(219201637/479001600).*t.^2+(sqrt(-1)*(1/12)).*t.^3+( ...
  1107079/29030400).*t.^4+(sqrt(-1)*(1/240)).*t.^5+(27677/21772800).*t.^6+ ...
  (sqrt(-1)*(1/10080)).*t.^7+(659/29030400).*t.^8+(sqrt(-1)*(1/725760)).* ...
  t.^9+(11/43545600).*t.^10+(sqrt(-1)*(1/79833600)).*t.^11+(1/479001600).* ...
  t.^12).*x.^10;





%s = @(t) integral(@(x) p(x, t), 0.001, 1000000)
s = int(j, x, 0.001, 1000000)

P = exp(1).^((sqrt(-1)*(-1)).*exp(1)+s((-1)))+exp(1).^((sqrt(-1)*(-1)).*exp( ...
  1)+s((-1))).*(1+t).*(sqrt(-1).*exp(1)+diff(s, 1).*(-1))+(1/2).* ...
  exp(1).^((sqrt(-1)*(-1)).*exp(1)+s((-1))).*(1+t).^2.*((sqrt(-1).*exp(1)+ ...
  diff(s, 2).*((-1))).^2+diff(s, 2).*((-1)))+(1/3).*exp(1).^(( ...
  sqrt(-1)*(-1)).*exp(1)+s((-1))).*(1+t).^3.*((sqrt(-1).*exp(1)+ ...
  diff(s, 1).*((-1))).*diff(s, 2).*((-1))+(1/2).*(sqrt(-1).*exp(1) ...
  +diff(s, 1).*((-1))).*((sqrt(-1).*exp(1)+diff(s, 1).*((-1))).^2+ ...
  diff(s, 2).*((-1)))+(1/2).*diff(s, 3).*((-1)))+(1/24).*exp(1).^( ...
  (sqrt(-1)*(-1)).*exp(1)+s((-1))).*(1+t).^4.*(exp(1).^4+(sqrt(-1)*(-4)).* ...
  exp(1).^3.*diff(s, 1).*((-1))+(-6).*exp(1).^2.*diff(s, 1).*((-1) ...
  ).^2+(sqrt(-1)*4).*exp(1).*diff(s, 1).*((-1)).^3+diff(s, 1).*(( ...
  -1)).^4+(-6).*exp(1).^2.*diff(s, 2).*((-1))+(sqrt(-1)*12).*exp(1).* ...
  diff(s, 1).*((-1)).*diff(s, 2).*((-1))+6.*diff(s, 1).*((-1)) ...
  .^2.*diff(s, 2).*((-1))+3.*diff(s, 2).*((-1))).^2+(sqrt(-1)*4).* ...
  exp(1).*diff(s, 3).*((-1))+4.*diff(s, 1).*((-1)).*diff(s, 3 ...
  ).*(-1)-1.*diff(s, 4);

taylor_p = @(t, E) (1 + (s(t) + 1i*E*t) +  ((s(t)+1i.*E.*t).^2)./(factorial(2)) + ((s(t)+1i.*E.*t).^3)./factorial(3)) + (((s(t) + 1i.*E.*t).^4)./(factorial(4)));

p_up = @(E) integral(@(t) taylor_p(t, E), 0.001, inf)
p_down = @(E) integral(@(t) taylor_p(t, E), -0.001, -inf)

rng = -1*10^-3:1*10^-5:0.3*10^-3
clear output
output = []
n = 1

for k=rng
output(n) = real(p_up(k) + p_down(k));
disp(k)
n = n + 1
end
figure
plot(rng, output)

